How It Works
---

- set gpio initial state to off on boot with `systemd`
- set `/etc/sudoers.d/http` to allow root command without password
- run `sudo` commands
	- **jquery** `$.get(...);` >> **php** `exec(...);` >> **python** `os.system(...)`
	- php: `exec()` needs full path command (plus `sudo` for root command)
- broadcast message
- use nginx 'pushstream' websocket
	- **php**  `exec('/usr/bin/curl -s -v -X POST "http://localhost/pub?id=amp" -d '.escapeshellarg('"message"'));`
	- **python** `requests.post("http://localhost/pub?id=amp", json="message")`
<hr>

- **jquery** 'get' php
	- `$.get('gpioon.php' / 'gpiooff.php');`
- **php** 'exec' python
	- `exec('sudo /root/gpiostatus.py');`
- **python** get pin status, set pin state
	- `GPIO.input()`
	- `GPIO.output()`
- **php** broadcast
	- if already on / off, 'die' - not broadcast
	- notify caller only
		- `exec('/usr/bin/curl -s -v -X POST "http://localhost/pub?id=amp" -d \"ON\"');`
	- notify all
		- `exec('sudo /root/gpioon.py' / 'gpiooff.py');`
	- if failed, 'curl' broadcast 'FAILED'
- **python**
	- off - kill idle timer process, set pin pulldown
		- `os.system('killall -9 gpiotimer.py')`
	- notify all to replace current broadcast 'ON' / 'OFF'
	- on - start idle timer in background
		- `exec('sudo /root/gpiotimer.py > /dev/null 2>&1 &');`
	- poll idle state
		- `python-mpd2`
		- `cat /proc/asound/card*/pcm*/sub*/status`
	- broadcast last minute warning
		- `python-requests`
	- notify all
		- `requests.post("http://localhost/pub?id=gpio", json=str(60) +"IDLE")`
- **php**
	- `exec('/usr/bin/sudo /root/gpioon.py');`
